{"title":"InfluxDB 配置用户权限（Docker）","date":"2021-01-20T00:00:00.000Z","link":"InfluxDB 配置用户权限（Docker）","tags":["Docker","InfluxDB"],"updated":"2021-03-12T08:22:58.406Z","content":"<h2 id=\"配置influxdb容器\"><a class=\"markdownIt-Anchor\" href=\"InfluxDB 配置用户权限（Docker）#配置influxdb容器\"></a> 配置InfluxDB容器<a href=\"InfluxDB 配置用户权限（Docker）#配置influxdb容器\"></a></h2>\n<ol>\n<li>拉取镜像</li>\n</ol>\n<p>镜像地址：<a href=\"https://hub.docker.com/_/influxdb\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/_/influxdb</a></p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull influxdb</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>确认镜像存在</p>\n  <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;   <span class=\"comment\"># docker image ls</span></span><br><span class=\"line\">&gt;   REPOSITORY   TAG       IMAGE ID       CREATED      SIZE</span><br><span class=\"line\">&gt;   influxdb     latest    0454d5d215cc   7 days ago   307MB</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></div></figure>\n</blockquote>\n<ol start=\"2\">\n<li>运行</li>\n</ol>\n <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name influxDB -p 8086:8086 influxdb:latest</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>确认容器存活</p>\n  <figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;   <span class=\"comment\"># docker container ls</span></span><br><span class=\"line\">&gt;   CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS         PORTS                    NAMES</span><br><span class=\"line\">&gt;   **********   influxdb   <span class=\"string\">\"/entrypoint.sh infl…\"</span>   48 minutes ago   Up 8 minutes   0.0.0.0:8086-&gt;8086/tcp   influxdb</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></div></figure>\n</blockquote>\n<p><strong>InfluxDB远程访问默认不需要权限校验，在生产环境中显然不合适，下面配置用户权限</strong></p>\n<h2 id=\"配置用户权限\"><a class=\"markdownIt-Anchor\" href=\"InfluxDB 配置用户权限（Docker）#配置用户权限\"></a> 配置用户权限<a href=\"InfluxDB 配置用户权限（Docker）#配置用户权限\"></a></h2>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 进入容器</span></span><br><span class=\"line\"><span class=\"comment\"># docker exec -it influxdb /bin/bash</span></span><br><span class=\"line\">root@07a5ee195563:/<span class=\"comment\"># influx</span></span><br><span class=\"line\">Connected to http://localhost:8086 version 1.8.3</span><br><span class=\"line\">InfluxDB shell version: 1.8.3</span><br><span class=\"line\"><span class=\"comment\">#创建用户并赋予所有权限</span></span><br><span class=\"line\">&gt; create user <span class=\"string\">\"admin\"</span> with password <span class=\"string\">'p@ssword'</span></span><br><span class=\"line\">&gt; grant all privileges to admin</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"启用权限验证\"><a class=\"markdownIt-Anchor\" href=\"InfluxDB 配置用户权限（Docker）#启用权限验证\"></a> 启用权限验证<a href=\"InfluxDB 配置用户权限（Docker）#启用权限验证\"></a></h2>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@07a5ee195563:/<span class=\"comment\"># echo /etc/influxdb/influxdb.conf</span></span><br><span class=\"line\">/etc/influxdb/influxdb.conf</span><br><span class=\"line\">root@07a5ee195563:/<span class=\"comment\"># cat /etc/influxdb/influxdb.conf</span></span><br><span class=\"line\">[meta]</span><br><span class=\"line\">  dir = <span class=\"string\">\"/var/lib/influxdb/meta\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">[data]</span><br><span class=\"line\">  dir = <span class=\"string\">\"/var/lib/influxdb/data\"</span></span><br><span class=\"line\">  engine = <span class=\"string\">\"tsm1\"</span></span><br><span class=\"line\">  wal-dir = <span class=\"string\">\"/var/lib/influxdb/wal\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">[http]</span><br><span class=\"line\">  auth-enabled = <span class=\"literal\">true</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>重启服务即可</li>\n</ul>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker restart influxDB</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"常用命令参考\"><a class=\"markdownIt-Anchor\" href=\"InfluxDB 配置用户权限（Docker）#常用命令参考\"></a> 常用命令参考<a href=\"InfluxDB 配置用户权限（Docker）#常用命令参考\"></a></h2>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示用户</span></span><br><span class=\"line\">SHOW USERS</span><br><span class=\"line\"><span class=\"comment\"># 创建用户</span></span><br><span class=\"line\">CREATE USER <span class=\"string\">\"username\"</span> WITH PASSWORD <span class=\"string\">'password'</span></span><br><span class=\"line\"><span class=\"comment\"># 赋予用户管理员权限</span></span><br><span class=\"line\">GRANT ALL PRIVILEGES TO username</span><br><span class=\"line\"><span class=\"comment\"># 创建管理员权限的用户</span></span><br><span class=\"line\">CREATE USER &lt;username&gt; WITH PASSWORD <span class=\"string\">'&lt;password&gt;'</span> WITH ALL PRIVILEGES</span><br><span class=\"line\"><span class=\"comment\"># 修改用户密码</span></span><br><span class=\"line\">SET PASSWORD FOR username = <span class=\"string\">'password'</span></span><br><span class=\"line\"><span class=\"comment\"># 撤消权限</span></span><br><span class=\"line\">REVOKE ALL ON mydb FROM username</span><br><span class=\"line\"><span class=\"comment\"># 查看权限</span></span><br><span class=\"line\">SHOW GRANTS FOR username</span><br><span class=\"line\"><span class=\"comment\"># 删除用户</span></span><br><span class=\"line\">DROP USER <span class=\"string\">\"username\"</span></span><br></pre></td></tr></table></div></figure>\n","prev":{"title":"Sentinel开源版接入InfluxDB数据持久化并使用Grafana可视化","link":"SentinelInfluxDB改造"},"next":{"title":"Spring MVC 拦截器规则的“例外”问题","link":"InterceptorSpringMVC"},"plink":"hanyuulu.github.io/InfluxDB 配置用户权限（Docker）/","toc":[{"title":"<a class=\"markdownIt-Anchor\"></a> 配置InfluxDB容器","id":"配置influxdb容器","index":"1"},{"title":"<a class=\"markdownIt-Anchor\"></a> 配置用户权限","id":"配置用户权限","index":"2"},{"title":"<a class=\"markdownIt-Anchor\"></a> 启用权限验证","id":"启用权限验证","index":"3"},{"title":"<a class=\"markdownIt-Anchor\"></a> 常用命令参考","id":"常用命令参考","index":"4"}],"copyright":{"author":"Hanyuu Lu","license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\">知识共享署名 4.0 国际许可协议</a>","published":"2021年1月20日","updated":"2021年3月12日"}}